local InterfaceManager = {}
InterfaceManager.Folder = "FluentXP"
InterfaceManager.Library = nil

function InterfaceManager:SetLibrary(lib)
    self.Library = lib
end

function InterfaceManager:SetFolder(folder)
    self.Folder = folder
end

local function GetWindow()
    if InterfaceManager.Library.GetWindow then
        return InterfaceManager.Library:GetWindow()
    end
    return InterfaceManager.Library.Window
end

local RGBEnabled = false
local RunService = game:GetService("RunService")

local function StartRGB(Fluent)
    if RGBEnabled then return end
    RGBEnabled = true

    task.spawn(function()
        while RGBEnabled do
            local hue = (tick() % 5) / 5
            local color = Color3.fromHSV(hue, 1, 1)

            if Fluent.SetColor then
                Fluent:SetColor("Accent", color)
                Fluent:SetColor("Primary", color)
                Fluent:SetColor("Secondary", color)
            elseif Fluent.Theme then
                Fluent.Theme.Accent = color
                Fluent.Theme.Primary = color
            end

            RunService.RenderStepped:Wait()
        end
    end)
end

local function StopRGB()
    RGBEnabled = false
end

function InterfaceManager:BuildInterfaceSection(Tab)
    if not self.Library then return end
    local Window = GetWindow()
    if not Window then return end

    Tab:AddParagraph({
        Title = "Interface Settings",
        Content = "FluentXP Interface Manager"
    })

    Tab:AddDropdown("ThemeSelector", {
        Title = "Theme",
        Values = {"Dark", "Light", "RGB"},
        Default = "Dark",
        Callback = function(Value)
            if Value == "RGB" then
                StartRGB(self.Library)
            else
                StopRGB()
                if self.Library.SetTheme then
                    self.Library:SetTheme(Value)
                end
            end
        end
    })

    Tab:AddToggle("SaveWindowPos", {
        Title = "Save Window Position",
        Default = true,
        Callback = function(Value)
            if Window and Window.SetSavePosition then
                Window:SetSavePosition(Value)
            end
        end
    })

    Tab:AddKeybind("MinimizeKey", {
        Title = "Minimize Key",
        Default = Enum.KeyCode.LeftControl,
        Callback = function(Key)
            if Window then
                Window.MinimizeKey = Key
            end
        end
    })
end

return InterfaceManager