local DiscordLib = {}
local cloneref = cloneref or function(o) return o end
COREGUI = cloneref(game:GetService("CoreGui"))
Players = cloneref(game:GetService("Players"))
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local HttpService = game:GetService("HttpService")
local pfp
local user
local tag
local userinfo = {}

-- Temas predefinidos
local Themes = {
    Dark = {
        Main = Color3.fromRGB(32, 34, 37),
        Secondary = Color3.fromRGB(47, 49, 54),
        Tertiary = Color3.fromRGB(54, 57, 63),
        Accent = Color3.fromRGB(114, 137, 218),
        Text = Color3.fromRGB(255, 255, 255),
        TextMuted = Color3.fromRGB(114, 118, 125),
        Userpad = Color3.fromRGB(41, 43, 47),
        UserIcon = Color3.fromRGB(31, 33, 36)
    },
    Light = {
        Main = Color3.fromRGB(255, 255, 255),
        Secondary = Color3.fromRGB(242, 243, 245),
        Tertiary = Color3.fromRGB(235, 237, 239),
        Accent = Color3.fromRGB(0, 100, 200),
        Text = Color3.fromRGB(0, 0, 0),
        TextMuted = Color3.fromRGB(100, 100, 100),
        Userpad = Color3.fromRGB(242, 243, 245),
        UserIcon = Color3.fromRGB(220, 221, 222)
    },
    Amoled = {
        Main = Color3.fromRGB(0, 0, 0),
        Secondary = Color3.fromRGB(10, 10, 10),
        Tertiary = Color3.fromRGB(20, 20, 20),
        Accent = Color3.fromRGB(114, 137, 218),
        Text = Color3.fromRGB(255, 255, 255),
        TextMuted = Color3.fromRGB(150, 150, 150),
        Userpad = Color3.fromRGB(5, 5, 5),
        UserIcon = Color3.fromRGB(15, 15, 15)
    }
}

local currentTheme = Themes.Dark

for _, XP in pairs(game:GetService("CoreGui"):GetChildren()) do
    if XP.Name == "Discord" then
        XP:Destroy()
    end
end
for _, XP in pairs(Players.LocalPlayer:FindFirstChild("PlayerGui"):GetChildren()) do
    if XP.Name == "DiscordToggle" then
        XP:Destroy()
    end
end

pcall(function()
    userinfo = HttpService:JSONDecode(readfile("discordlibinfo.txt"));
end)
pfp = userinfo["pfp"] or "https://www.roblox.com/headshot-thumbnail/image?userId="..Players.LocalPlayer.UserId.."&width=420&height=420&format=png"
user =  userinfo["user"] or Players.LocalPlayer.Name
tag = userinfo["tag"] or tostring(math.random(1000,9999))

local function SaveInfo()
    userinfo["pfp"] = pfp
    userinfo["user"] = user
    userinfo["tag"] = tag
    writefile("discordlibinfo.txt", HttpService:JSONEncode(userinfo));
end

local function MakeDraggable(topbarobject, object)
    local Dragging = nil
    local DragInput = nil
    local DragStart = nil
    local StartPosition = nil

    local function Update(input)
        local Delta = input.Position - DragStart
        local pos = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
        object.Position = pos
    end

    topbarobject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPosition = object.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)

    topbarobject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            Update(input)
        end
    end)
end

local Discord = Instance.new("ScreenGui")
Discord.Name = "Discord"
Discord.Parent = game.CoreGui
Discord.ZIndexBehavior = Enum.ZIndexBehavior.Global

-- Toggle Button
spawn(function()
    local ScreenGui = Instance.new("ScreenGui")
    local ABDC = Instance.new("TextButton")
    ScreenGui.Name = "DiscordToggle"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = Players.LocalPlayer:FindFirstChild("PlayerGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    ABDC.Name = math.random()
    ABDC.Parent = ScreenGui
    ABDC.Draggable = true
    ABDC.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    ABDC.BorderSizePixel = 0
    ABDC.Position = UDim2.new(0.8, 0, 0.9, 0)
    ABDC.Size = UDim2.new(0, 80, 0, 25)
    ABDC.Font = Enum.Font.SourceSans
    ABDC.Text = "Enabled"
    ABDC.TextColor3 = Color3.fromRGB(255, 255, 255)
    ABDC.TextSize = 14
    ABDC.ZIndex = 10
    local isEnabled = false
    local function toggleState()
        isEnabled = not isEnabled
        local DiscordGui = game:GetService("CoreGui"):FindFirstChild("Discord")
        if isEnabled then
            ABDC.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            ABDC.Text = "Enabled"
            if DiscordGui then
                DiscordGui.Enabled = true
            end
        else
            ABDC.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            ABDC.Text = "Disabled"
            if DiscordGui then
                DiscordGui.Enabled = false
            end
        end
    end
    ABDC.MouseButton1Click:Connect(toggleState)
    local function initialize()
        local DiscordGui = game:GetService("CoreGui"):FindFirstChild("Discord")
        if DiscordGui then
            isEnabled = DiscordGui.Enabled
            if isEnabled then
                ABDC.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
                ABDC.Text = "Enabled"
            else
                ABDC.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                ABDC.Text = "Disabled"
            end
        else
            ABDC.Text = "Error Found Lib"
        end
    end
    initialize()
end)

function DiscordLib:Window(text)
    local currentservertoggled = ""
    local currentchanneltoggled = ""
    local minimized = false
    local fs = false
    local settingsopened = false
    local MainFrame = Instance.new("Frame")
    local TopFrame = Instance.new("Frame")
    local Title = Instance.new("TextLabel")
    local CloseBtn = Instance.new("TextButton")
    local CloseIcon = Instance.new("ImageLabel")
    local ServersHolder = Instance.new("Folder")
    local Userpad = Instance.new("Frame")
    local UserIcon = Instance.new("Frame")
    local UserIconCorner = Instance.new("UICorner")
    local UserImage = Instance.new("ImageLabel")
    local UserCircleImage = Instance.new("ImageLabel")
    local UserName = Instance.new("TextLabel")
    local UserTag = Instance.new("TextLabel")
    local ServersHoldFrame = Instance.new("Frame")
    local ServersHold = Instance.new("ScrollingFrame")
    local ServersHoldLayout = Instance.new("UIListLayout")
    local ServersHoldPadding = Instance.new("UIPadding")
    local TopFrameHolder = Instance.new("Frame")
    local MainCorner = Instance.new("UICorner")
    local ChannelsHoldFrame = Instance.new("Frame")
    local ChannelsHold = Instance.new("ScrollingFrame")
    local ChannelsHoldLayout = Instance.new("UIListLayout")

    -- TAMAÑOS REDUCIDOS
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = Discord
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.BackgroundColor3 = currentTheme.Main
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    MainFrame.Size = UDim2.new(0, 650, 0, 400)  -- REDUCIDO de 800x500 a 650x400
    MainFrame.ZIndex = 1

    MainCorner.CornerRadius = UDim.new(0, 6)  -- REDUCIDO de 8 a 6
    MainCorner.Parent = MainFrame

    TopFrame.Name = "TopFrame"
    TopFrame.Parent = MainFrame
    TopFrame.BackgroundColor3 = currentTheme.Main
    TopFrame.BackgroundTransparency = 1.000
    TopFrame.BorderSizePixel = 0
    TopFrame.Position = UDim2.new(-0.000658480625, 0, 0, 0)
    TopFrame.Size = UDim2.new(0, 650, 0, 28)  -- REDUCIDO de 35 a 28
    TopFrame.ZIndex = 2

    TopFrameHolder.Name = "TopFrameHolder"
    TopFrameHolder.Parent = TopFrame
    TopFrameHolder.BackgroundColor3 = currentTheme.Main
    TopFrameHolder.BackgroundTransparency = 1.000
    TopFrameHolder.BorderSizePixel = 0
    TopFrameHolder.Position = UDim2.new(-0.000658480625, 0, 0, 0)
    TopFrameHolder.Size = UDim2.new(0, 650, 0, 28)
    TopFrameHolder.ZIndex = 2

    Title.Name = "Title"
    Title.Parent = TopFrame
    Title.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1.000
    Title.Position = UDim2.new(0.01, 0, 0, 0)
    Title.Size = UDim2.new(0, 200, 0, 28)
    Title.Font = Enum.Font.Gotham
    Title.Text = text
    Title.TextColor3 = currentTheme.TextMuted
    Title.TextSize = 14.000  -- REDUCIDO de 16 a 14
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 3

    -- Userpad más compacto
    Userpad.Name = "Userpad"
    Userpad.Parent = TopFrame
    Userpad.BackgroundColor3 = currentTheme.Userpad
    Userpad.BorderSizePixel = 0
    Userpad.Position = UDim2.new(0.72, 0, 0, 0)  -- Ajustado
    Userpad.Size = UDim2.new(0, 160, 0, 28)  -- REDUCIDO de 180x35 a 160x28
    Userpad.ZIndex = 10
    Userpad.BackgroundTransparency = 0.3

    UserIcon.Name = "UserIcon"
    UserIcon.Parent = Userpad
    UserIcon.BackgroundColor3 = currentTheme.UserIcon
    UserIcon.BorderSizePixel = 0
    UserIcon.Position = UDim2.new(0.05, 0, 0.1, 0)
    UserIcon.Size = UDim2.new(0, 22, 0, 22)  -- REDUCIDO de 28x28 a 22x22
    UserIcon.ZIndex = 11

    UserIconCorner.CornerRadius = UDim.new(1, 2)  -- REDUCIDO
    UserIconCorner.Name = "UserIconCorner"
    UserIconCorner.Parent = UserIcon

    UserImage.Name = "UserImage"
    UserImage.Parent = UserIcon
    UserImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    UserImage.BackgroundTransparency = 1.000
    UserImage.Size = UDim2.new(0, 22, 0, 22)
    UserImage.Image = pfp
    UserImage.ZIndex = 12

    UserCircleImage.Name = "UserImage"
    UserCircleImage.Parent = UserImage
    UserCircleImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    UserCircleImage.BackgroundTransparency = 1.000
    UserCircleImage.Size = UDim2.new(0, 22, 0, 22)
    UserCircleImage.Image = "rbxassetid://4031889928"
    UserCircleImage.ImageColor3 = currentTheme.Userpad
    UserCircleImage.ZIndex = 13

    UserName.Name = "UserName"
    UserName.Parent = Userpad
    UserName.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    UserName.BackgroundTransparency = 1.000
    UserName.BorderSizePixel = 0
    UserName.Position = UDim2.new(0.22, 0, 0, 0)
    UserName.Size = UDim2.new(0, 100, 0, 14)  -- REDUCIDO
    UserName.Font = Enum.Font.GothamSemibold
    UserName.TextColor3 = currentTheme.Text
    UserName.TextSize = 11.000  -- REDUCIDO de 13 a 11
    UserName.TextXAlignment = Enum.TextXAlignment.Left
    UserName.ClipsDescendants = true
    UserName.ZIndex = 11

    UserTag.Name = "UserTag"
    UserTag.Parent = Userpad
    UserTag.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    UserTag.BackgroundTransparency = 1.000
    UserTag.BorderSizePixel = 0
    UserTag.Position = UDim2.new(0.22, 0, 0.5, 0)
    UserTag.Size = UDim2.new(0, 100, 0, 14)
    UserTag.Font = Enum.Font.Gotham
    UserTag.TextColor3 = currentTheme.Text
    UserTag.TextSize = 10.000  -- REDUCIDO de 12 a 10
    UserTag.TextTransparency = 0.300
    UserTag.TextXAlignment = Enum.TextXAlignment.Left
    UserTag.ZIndex = 11

    UserName.Text = user
    UserTag.Text = "#" .. tag

    -- ELIMINADA la X (CloseBtn)
    MakeDraggable(TopFrame, MainFrame)

    -- Servidores más compactos
    ServersHoldFrame.Name = "ServersHoldFrame"
    ServersHoldFrame.Parent = MainFrame
    ServersHoldFrame.BackgroundColor3 = currentTheme.Secondary
    ServersHoldFrame.BorderSizePixel = 0
    ServersHoldFrame.Position = UDim2.new(0.01, 0, 0.08, 0)
    ServersHoldFrame.Size = UDim2.new(0, 60, 0, 350)  -- REDUCIDO de 70x440 a 60x350
    ServersHoldFrame.ZIndex = 2

    local ServersHoldFrameCorner = Instance.new("UICorner")
    ServersHoldFrameCorner.CornerRadius = UDim.new(0, 6)  -- REDUCIDO de 8 a 6
    ServersHoldFrameCorner.Parent = ServersHoldFrame

    ServersHold.Name = "ServersHold"
    ServersHold.Parent = ServersHoldFrame
    ServersHold.Active = true
    ServersHold.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ServersHold.BackgroundTransparency = 1.000
    ServersHold.BorderSizePixel = 0
    ServersHold.Position = UDim2.new(0, 5, 0, 5)
    ServersHold.Size = UDim2.new(0, 50, 0, 340)  -- REDUCIDO
    ServersHold.CanvasSize = UDim2.new(0, 0, 0, 0)
    ServersHold.ScrollBarThickness = 0
    ServersHold.ZIndex = 3

    ServersHoldLayout.Name = "ServersHoldLayout"
    ServersHoldLayout.Parent = ServersHold
    ServersHoldLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    ServersHoldLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ServersHoldLayout.Padding = UDim.new(0, 3)  -- REDUCIDO de 5 a 3

    ServersHoldPadding.Name = "ServersHoldPadding"
    ServersHoldPadding.Parent = ServersHold
    ServersHoldPadding.PaddingTop = UDim.new(0, 5)

    -- Canales más compactos
    ChannelsHoldFrame.Name = "ChannelsHoldFrame"
    ChannelsHoldFrame.Parent = MainFrame
    ChannelsHoldFrame.BackgroundColor3 = currentTheme.Secondary
    ChannelsHoldFrame.BorderSizePixel = 0
    ChannelsHoldFrame.Position = UDim2.new(0.12, 0, 0.08, 0)
    ChannelsHoldFrame.Size = UDim2.new(0, 130, 0, 350)  -- REDUCIDO de 160x440 a 130x350
    ChannelsHoldFrame.ZIndex = 2

    local ChannelsHoldFrameCorner = Instance.new("UICorner")
    ChannelsHoldFrameCorner.CornerRadius = UDim.new(0, 6)
    ChannelsHoldFrameCorner.Parent = ChannelsHoldFrame

    ChannelsHold.Name = "ChannelsHold"
    ChannelsHold.Parent = ChannelsHoldFrame
    ChannelsHold.Active = true
    ChannelsHold.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ChannelsHold.BackgroundTransparency = 1.000
    ChannelsHold.BorderSizePixel = 0
    ChannelsHold.Position = UDim2.new(0, 5, 0, 5)
    ChannelsHold.Size = UDim2.new(0, 120, 0, 340)  -- REDUCIDO
    ChannelsHold.CanvasSize = UDim2.new(0, 0, 0, 0)
    ChannelsHold.ScrollBarThickness = 4
    ChannelsHold.ZIndex = 3

    ChannelsHoldLayout.Name = "ChannelsHoldLayout"
    ChannelsHoldLayout.Parent = ChannelsHold
    ChannelsHoldLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
    ChannelsHoldLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ChannelsHoldLayout.Padding = UDim.new(0, 2)

    local Servers = {}
    local ServerChannels = {}
    local Sections = {}

    -- Función para cambiar el tema
    function DiscordLib:SetTheme(themeName)
        local newTheme
        if type(themeName) == "string" then
            newTheme = Themes[themeName] or Themes.Dark
        else
            newTheme = {
                Main = themeName,
                Secondary = themeName:lerp(Color3.new(0, 0, 0), 0.2),
                Tertiary = themeName:lerp(Color3.new(0, 0, 0), 0.3),
                Accent = Color3.fromRGB(114, 137, 218),
                Text = Color3.fromRGB(255, 255, 255),
                TextMuted = Color3.fromRGB(150, 150, 150),
                Userpad = themeName:lerp(Color3.new(0, 0, 0), 0.4),
                UserIcon = themeName:lerp(Color3.new(0, 0, 0), 0.5)
            }
        end
        
        currentTheme = newTheme
        
        MainFrame.BackgroundColor3 = newTheme.Main
        TopFrame.BackgroundColor3 = newTheme.Main
        TopFrameHolder.BackgroundColor3 = newTheme.Main
        Title.TextColor3 = newTheme.TextMuted
        ServersHoldFrame.BackgroundColor3 = newTheme.Secondary
        ChannelsHoldFrame.BackgroundColor3 = newTheme.Secondary
        Userpad.BackgroundColor3 = newTheme.Userpad
        UserIcon.BackgroundColor3 = newTheme.UserIcon
        UserCircleImage.ImageColor3 = newTheme.Userpad
        UserName.TextColor3 = newTheme.Text
        UserTag.TextColor3 = newTheme.Text
    end

    -- Crear un servidor
    function Servers:Server(Name, Image)
        ServerChannels[Name] = ServerChannels[Name] or {}
        
        local ServerBtn = Instance.new("TextButton")
        local ServerIcon = Instance.new("ImageLabel")
        local ServerCorner = Instance.new("UICorner")

        ServerBtn.Name = Name
        ServerBtn.Parent = ServersHold
        ServerBtn.BackgroundColor3 = currentTheme.Tertiary
        ServerBtn.BorderSizePixel = 0
        ServerBtn.Size = UDim2.new(0, 40, 0, 40)  -- REDUCIDO de 50x50 a 40x40
        ServerBtn.AutoButtonColor = false
        ServerBtn.Text = ""
        ServerBtn.BackgroundTransparency = 0.5
        ServerBtn.ZIndex = 4

        ServerCorner.CornerRadius = UDim.new(0, 20)  -- REDUCIDO
        ServerCorner.Parent = ServerBtn

        ServerIcon.Name = "ServerIcon"
        ServerIcon.Parent = ServerBtn
        ServerIcon.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ServerIcon.BackgroundTransparency = 1.000
        ServerIcon.Size = UDim2.new(0, 36, 0, 36)  -- REDUCIDO
        ServerIcon.Position = UDim2.new(0, 2, 0, 2)
        ServerIcon.Image = Image
        ServerIcon.ImageColor3 = currentTheme.Text
        ServerIcon.ZIndex = 5

        local ServerIconCorner = Instance.new("UICorner")
        ServerIconCorner.CornerRadius = UDim.new(0, 18)  -- REDUCIDO
        ServerIconCorner.Parent = ServerIcon

        ServersHold.CanvasSize = UDim2.new(0, 0, 0, ServersHoldLayout.AbsoluteContentSize.Y)

        ServerBtn.MouseButton1Click:Connect(function()
            for i, v in pairs(ServersHold:GetChildren()) do
                if v:IsA("TextButton") then
                    TweenService:Create(v, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
                end
            end
            TweenService:Create(ServerBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()

            currentservertoggled = Name
            
            for channelName, channelData in pairs(ServerChannels[Name]) do
                if channelData.Button then
                    channelData.Button.Visible = true
                end
            end
            
            for otherServer, channels in pairs(ServerChannels) do
                if otherServer ~= Name then
                    for _, channelData in pairs(channels) do
                        if channelData.Button then
                            channelData.Button.Visible = false
                        end
                    end
                end
            end
            
            if currentchanneltoggled and ServerChannels[Name][currentchanneltoggled] then
                ServerChannels[Name][currentchanneltoggled].Button.BackgroundColor3 = currentTheme.Accent
                for sectionName, section in pairs(Sections) do
                    if sectionName:match("^" .. Name .. ":" .. currentchanneltoggled) then
                        section.Visible = true
                    else
                        section.Visible = false
                    end
                end
            end
        end)

        return ServerBtn
    end

    -- Crear un canal seleccionable
    function Servers:Channel(serverName, channelName)
        if not serverName or not channelName then
            warn("DiscordLib: Server name and channel name cannot be nil")
            return {}
        end
        
        ServerChannels[serverName] = ServerChannels[serverName] or {}
        
        local ChannelBtn = Instance.new("TextButton")
        local ChannelBtnCorner = Instance.new("UICorner")
        local ChannelIcon = Instance.new("TextLabel")

        ChannelBtn.Name = channelName
        ChannelBtn.Parent = ChannelsHold
        ChannelBtn.BackgroundColor3 = currentTheme.Tertiary
        ChannelBtn.BackgroundTransparency = 0.7
        ChannelBtn.BorderSizePixel = 0
        ChannelBtn.Size = UDim2.new(0, 110, 0, 24)  -- REDUCIDO de 140x28 a 110x24
        ChannelBtn.AutoButtonColor = false
        ChannelBtn.Text = ""
        ChannelBtn.ZIndex = 4
        ChannelBtn.Visible = false

        ChannelBtnCorner.CornerRadius = UDim.new(0, 4)  -- REDUCIDO
        ChannelBtnCorner.Parent = ChannelBtn

        ChannelIcon.Name = "ChannelIcon"
        ChannelIcon.Parent = ChannelBtn
        ChannelIcon.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ChannelIcon.BackgroundTransparency = 1.000
        ChannelIcon.Position = UDim2.new(0, 5, 0, 0)
        ChannelIcon.Size = UDim2.new(0, 15, 0, 24)
        ChannelIcon.Font = Enum.Font.Gotham
        ChannelIcon.Text = "#"
        ChannelIcon.TextColor3 = currentTheme.TextMuted
        ChannelIcon.TextSize = 14.000
        ChannelIcon.TextXAlignment = Enum.TextXAlignment.Left
        ChannelIcon.ZIndex = 5

        local ChannelLabel = Instance.new("TextLabel")
        ChannelLabel.Parent = ChannelBtn
        ChannelLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ChannelLabel.BackgroundTransparency = 1.000
        ChannelLabel.Position = UDim2.new(0, 22, 0, 0)
        ChannelLabel.Size = UDim2.new(0, 85, 0, 24)
        ChannelLabel.Font = Enum.Font.Gotham
        ChannelLabel.Text = channelName
        ChannelLabel.TextColor3 = currentTheme.Text
        ChannelLabel.TextSize = 12.000  -- REDUCIDO de 13 a 12
        ChannelLabel.TextXAlignment = Enum.TextXAlignment.Left
        ChannelLabel.ZIndex = 5

        ChannelsHold.CanvasSize = UDim2.new(0, 0, 0, ChannelsHoldLayout.AbsoluteContentSize.Y)

        ServerChannels[serverName][channelName] = {
            Button = ChannelBtn,
            Icon = ChannelIcon,
            Label = ChannelLabel
        }

        ChannelBtn.MouseButton1Click:Connect(function()
            for _, channelData in pairs(ServerChannels[serverName]) do
                if channelData.Button then
                    channelData.Button.BackgroundColor3 = currentTheme.Tertiary
                    channelData.Button.BackgroundTransparency = 0.7
                end
            end
            
            ChannelBtn.BackgroundColor3 = currentTheme.Accent
            ChannelBtn.BackgroundTransparency = 0
            currentchanneltoggled = channelName
            
            local fullName = serverName .. ":" .. channelName
            for sectionName, section in pairs(Sections) do
                if sectionName == fullName then
                    section.Visible = true
                else
                    section.Visible = false
                end
            end
        end)

        ChannelBtn.MouseEnter:Connect(function()
            if ChannelBtn.BackgroundTransparency > 0 then
                TweenService:Create(ChannelBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
            end
        end)

        ChannelBtn.MouseLeave:Connect(function()
            if ChannelBtn.BackgroundTransparency > 0 then
                TweenService:Create(ChannelBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.7}):Play()
            end
        end)

        -- Sección más compacta
        local SectionFrame = Instance.new("ScrollingFrame")
        local SectionLayout = Instance.new("UIListLayout")
        local SectionPadding = Instance.new("UIPadding")
        local SectionTitle = Instance.new("TextLabel")

        local fullName = serverName .. ":" .. channelName

        SectionFrame.Name = fullName .. "SectionFrame"
        SectionFrame.Parent = MainFrame
        SectionFrame.BackgroundColor3 = currentTheme.Secondary
        SectionFrame.BackgroundTransparency = 0
        SectionFrame.BorderSizePixel = 0
        SectionFrame.Position = UDim2.new(0.35, 0, 0.08, 0)
        SectionFrame.Size = UDim2.new(0, 390, 0, 350)  -- REDUCIDO de 480x440 a 390x350
        SectionFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        SectionFrame.ScrollBarThickness = 4
        SectionFrame.Visible = false
        SectionFrame.ZIndex = 5

        SectionTitle.Name = "SectionTitle"
        SectionTitle.Parent = SectionFrame
        SectionTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        SectionTitle.BackgroundTransparency = 1.000
        SectionTitle.Size = UDim2.new(0, 380, 0, 25)  -- REDUCIDO
        SectionTitle.Font = Enum.Font.GothamBold
        SectionTitle.Text = "# " .. channelName .. "  •  " .. serverName
        SectionTitle.TextColor3 = currentTheme.Text
        SectionTitle.TextSize = 16.000  -- REDUCIDO de 18 a 16
        SectionTitle.TextXAlignment = Enum.TextXAlignment.Left
        SectionTitle.ZIndex = 6

        SectionLayout.Name = "SectionLayout"
        SectionLayout.Parent = SectionFrame
        SectionLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
        SectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
        SectionLayout.Padding = UDim.new(0, 3)  -- REDUCIDO de 5 a 3

        SectionPadding.Name = "SectionPadding"
        SectionPadding.Parent = SectionFrame
        SectionPadding.PaddingLeft = UDim.new(0, 6)  -- REDUCIDO de 8 a 6
        SectionPadding.PaddingTop = UDim.new(0, 30)  -- REDUCIDO de 35 a 30

        Sections[fullName] = SectionFrame

        local Section = {}

        function Section:Label(text)
            local Label = Instance.new("TextLabel")
            Label.Parent = SectionFrame
            Label.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Label.BackgroundTransparency = 1.000
            Label.Size = UDim2.new(0, 370, 0, 18)  -- REDUCIDO de 460x20 a 370x18
            Label.Font = Enum.Font.GothamBold
            Label.Text = text
            Label.TextColor3 = currentTheme.Text
            Label.TextSize = 11.000  -- REDUCIDO de 12 a 11
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.ZIndex = 6

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return Label
        end

        function Section:Seperator()
            local Seperator = Instance.new("Frame")
            local SeperatorCorner = Instance.new("UICorner")
            
            Seperator.Parent = SectionFrame
            Seperator.BackgroundColor3 = currentTheme.TextMuted
            Seperator.BackgroundTransparency = 0.7
            Seperator.BorderSizePixel = 0
            Seperator.Size = UDim2.new(0, 370, 0, 1)  -- REDUCIDO
            Seperator.ZIndex = 6
            
            SeperatorCorner.CornerRadius = UDim.new(0, 1)
            SeperatorCorner.Parent = Seperator
            
            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return Seperator
        end

        function Section:Button(text, callback)
            local Button = Instance.new("TextButton")
            local ButtonCorner = Instance.new("UICorner")

            Button.Parent = SectionFrame
            Button.BackgroundColor3 = currentTheme.Tertiary
            Button.BorderSizePixel = 0
            Button.Size = UDim2.new(0, 370, 0, 28)  -- REDUCIDO de 460x32 a 370x28
            Button.AutoButtonColor = false
            Button.Text = text
            Button.Font = Enum.Font.Gotham
            Button.TextColor3 = currentTheme.Text
            Button.TextSize = 13.000  -- REDUCIDO de 14 a 13
            Button.ZIndex = 6

            ButtonCorner.CornerRadius = UDim.new(0, 4)
            ButtonCorner.Parent = Button

            Button.MouseButton1Click:Connect(function()
                if callback then
                    callback()
                end
            end)

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return Button
        end

        function Section:Toggle(text, default, callback)
            local Toggle = Instance.new("TextButton")
            local ToggleLabel = Instance.new("TextLabel")
            local ToggleImage = Instance.new("ImageLabel")
            local ToggleCorner = Instance.new("UICorner")
            local ToggleImageCorner = Instance.new("UICorner")

            local toggled = default or false

            Toggle.Parent = SectionFrame
            Toggle.BackgroundColor3 = currentTheme.Tertiary
            Toggle.BorderSizePixel = 0
            Toggle.Size = UDim2.new(0, 370, 0, 28)  -- REDUCIDO
            Toggle.AutoButtonColor = false
            Toggle.Text = ""
            Toggle.Font = Enum.Font.Gotham
            Toggle.TextColor3 = currentTheme.Text
            Toggle.TextSize = 13.000
            Toggle.ZIndex = 6

            ToggleCorner.CornerRadius = UDim.new(0, 4)
            ToggleCorner.Parent = Toggle

            ToggleLabel.Parent = Toggle
            ToggleLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            ToggleLabel.BackgroundTransparency = 1.000
            ToggleLabel.Position = UDim2.new(0, 5, 0, 0)
            ToggleLabel.Size = UDim2.new(0, 310, 0, 28)  -- REDUCIDO
            ToggleLabel.Font = Enum.Font.Gotham
            ToggleLabel.Text = text
            ToggleLabel.TextColor3 = currentTheme.Text
            ToggleLabel.TextSize = 13.000
            ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
            ToggleLabel.ZIndex = 7

            ToggleImage.Parent = Toggle
            ToggleImage.BackgroundColor3 = currentTheme.Secondary
            ToggleImage.BorderSizePixel = 0
            ToggleImage.Position = UDim2.new(0, 340, 0, 4)  -- REDUCIDO
            ToggleImage.Size = UDim2.new(0, 18, 0, 18)  -- REDUCIDO de 20x20 a 18x18
            ToggleImage.Image = toggled and "rbxassetid://6035067836" or ""
            ToggleImage.ZIndex = 7

            ToggleImageCorner.CornerRadius = UDim.new(0, 3)  -- REDUCIDO
            ToggleImageCorner.Parent = ToggleImage

            local function updateToggle()
                toggled = not toggled
                ToggleImage.Image = toggled and "rbxassetid://6035067836" or ""
                if callback then
                    callback(toggled)
                end
            end

            Toggle.MouseButton1Click:Connect(updateToggle)

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return Toggle
        end

        function Section:Slider(text, min, max, default, callback)
            local SliderFrame = Instance.new("Frame")
            local SliderLabel = Instance.new("TextLabel")
            local SliderValue = Instance.new("TextLabel")
            local SliderBar = Instance.new("Frame")
            local SliderButton = Instance.new("TextButton")
            local SliderFill = Instance.new("Frame")
            local SliderCorner = Instance.new("UICorner")
            local SliderFillCorner = Instance.new("UICorner")
            local SliderButtonCorner = Instance.new("UICorner")

            local value = default or min
            local dragging = false

            SliderFrame.Parent = SectionFrame
            SliderFrame.BackgroundColor3 = currentTheme.Tertiary
            SliderFrame.BorderSizePixel = 0
            SliderFrame.Size = UDim2.new(0, 370, 0, 45)  -- REDUCIDO de 460x52 a 370x45
            SliderFrame.ZIndex = 6

            SliderCorner.CornerRadius = UDim.new(0, 4)
            SliderCorner.Parent = SliderFrame

            SliderLabel.Parent = SliderFrame
            SliderLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            SliderLabel.BackgroundTransparency = 1.000
            SliderLabel.Position = UDim2.new(0, 5, 0, 5)
            SliderLabel.Size = UDim2.new(0, 220, 0, 18)  -- REDUCIDO
            SliderLabel.Font = Enum.Font.Gotham
            SliderLabel.Text = text
            SliderLabel.TextColor3 = currentTheme.Text
            SliderLabel.TextSize = 13.000
            SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
            SliderLabel.ZIndex = 7

            SliderValue.Parent = SliderFrame
            SliderValue.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            SliderValue.BackgroundTransparency = 1.000
            SliderValue.Position = UDim2.new(0, 330, 0, 5)  -- REDUCIDO
            SliderValue.Size = UDim2.new(0, 35, 0, 18)  -- REDUCIDO
            SliderValue.Font = Enum.Font.Gotham
            SliderValue.Text = tostring(value)
            SliderValue.TextColor3 = currentTheme.Text
            SliderValue.TextSize = 13.000
            SliderValue.ZIndex = 7

            SliderBar.Parent = SliderFrame
            SliderBar.BackgroundColor3 = currentTheme.Secondary
            SliderBar.BorderSizePixel = 0
            SliderBar.Position = UDim2.new(0, 10, 0, 26)  -- Ajustado
            SliderBar.Size = UDim2.new(0, 350, 0, 10)  -- REDUCIDO de 440x12 a 350x10
            SliderBar.ZIndex = 7

            local SliderBarCorner = Instance.new("UICorner")
            SliderBarCorner.CornerRadius = UDim.new(0, 5)  -- REDUCIDO
            SliderBarCorner.Parent = SliderBar

            SliderFill.Parent = SliderBar
            SliderFill.BackgroundColor3 = currentTheme.Accent
            SliderFill.BorderSizePixel = 0
            SliderFill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
            SliderFill.ZIndex = 8

            SliderFillCorner.CornerRadius = UDim.new(0, 5)
            SliderFillCorner.Parent = SliderFill

            SliderButton.Parent = SliderBar
            SliderButton.BackgroundColor3 = currentTheme.Text
            SliderButton.BorderSizePixel = 0
            SliderButton.Position = UDim2.new((value - min) / (max - min), -5, 0, -1)  -- Ajustado
            SliderButton.Size = UDim2.new(0, 10, 0, 12)  -- REDUCIDO de 12x12 a 10x12
            SliderButton.Text = ""
            SliderButton.AutoButtonColor = false
            SliderButton.ZIndex = 9

            SliderButtonCorner.CornerRadius = UDim.new(0, 5)
            SliderButtonCorner.Parent = SliderButton

            local function updateSlider(input)
                local pos = input.Position.X - SliderBar.AbsolutePosition.X
                local size = SliderBar.AbsoluteSize.X
                local percent = math.clamp(pos / size, 0, 1)
                value = min + (max - min) * percent
                SliderValue.Text = tostring(math.floor(value))
                SliderFill.Size = UDim2.new(percent, 0, 1, 0)
                SliderButton.Position = UDim2.new(percent, -5, 0, -1)
                if callback then
                    callback(math.floor(value))
                end
            end

            SliderButton.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    updateSlider(input)
                end
            end)

            SliderButton.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                    if dragging then
                        updateSlider(input)
                    end
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            SliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    updateSlider(input)
                end
            end)

            local sliderObject = {}
            function sliderObject:Change(newValue)
                value = math.clamp(newValue, min, max)
                local percent = (value - min) / (max - min)
                SliderValue.Text = tostring(math.floor(value))
                SliderFill.Size = UDim2.new(percent, 0, 1, 0)
                SliderButton.Position = UDim2.new(percent, -5, 0, -1)
                if callback then
                    callback(math.floor(value))
                end
            end

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return sliderObject
        end

function Section:Colorpicker(text, default, callback)
    local ColorPickerFrame = Instance.new("Frame")
    local ColorPickerLabel = Instance.new("TextLabel")
    local ColorButton = Instance.new("TextButton")
    local ColorDisplay = Instance.new("Frame")
    local ColorDisplayCorner = Instance.new("UICorner")
    local ColorPickerCorner = Instance.new("UICorner")

    local selectedColor = default or Color3.fromRGB(255, 255, 255)
    local picking = false

    ColorPickerFrame.Parent = SectionFrame
    ColorPickerFrame.BackgroundColor3 = currentTheme.Tertiary
    ColorPickerFrame.BorderSizePixel = 0
    ColorPickerFrame.Size = UDim2.new(0, 370, 0, 38)
    ColorPickerFrame.ZIndex = 6

    ColorPickerCorner.CornerRadius = UDim.new(0, 4)
    ColorPickerCorner.Parent = ColorPickerFrame

    ColorPickerLabel.Parent = ColorPickerFrame
    ColorPickerLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ColorPickerLabel.BackgroundTransparency = 1.000
    ColorPickerLabel.Position = UDim2.new(0, 5, 0, 0)
    ColorPickerLabel.Size = UDim2.new(0, 310, 0, 38)
    ColorPickerLabel.Font = Enum.Font.Gotham
    ColorPickerLabel.Text = text
    ColorPickerLabel.TextColor3 = currentTheme.Text
    ColorPickerLabel.TextSize = 13.000
    ColorPickerLabel.TextXAlignment = Enum.TextXAlignment.Left
    ColorPickerLabel.ZIndex = 7

    ColorButton.Parent = ColorPickerFrame
    ColorButton.BackgroundColor3 = currentTheme.Secondary
    ColorButton.BorderSizePixel = 0
    ColorButton.Position = UDim2.new(0, 330, 0, 5)
    ColorButton.Size = UDim2.new(0, 26, 0, 26)
    ColorButton.Text = ""
    ColorButton.AutoButtonColor = false
    ColorButton.ZIndex = 7

    local ColorButtonCorner = Instance.new("UICorner")
    ColorButtonCorner.CornerRadius = UDim.new(0, 5)
    ColorButtonCorner.Parent = ColorButton

    ColorDisplay.Parent = ColorButton
    ColorDisplay.BackgroundColor3 = selectedColor
    ColorDisplay.BorderSizePixel = 0
    ColorDisplay.Position = UDim2.new(0, 2, 0, 2)
    ColorDisplay.Size = UDim2.new(0, 22, 0, 22)
    ColorDisplay.ZIndex = 8

    ColorDisplayCorner.CornerRadius = UDim.new(0, 4)
    ColorDisplayCorner.Parent = ColorDisplay

    local function createColorPickerPopup()
        if picking then return end
        picking = true

        -- FONDO OSCURO CON FADE IN
        local BackgroundOverlay = Instance.new("Frame")
        BackgroundOverlay.Name = "ColorPickerOverlay"
        BackgroundOverlay.Parent = MainFrame
        BackgroundOverlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        BackgroundOverlay.BackgroundTransparency = 1  -- Comienza invisible
        BackgroundOverlay.BorderSizePixel = 0
        BackgroundOverlay.Size = UDim2.new(1, 0, 1, 0)
        BackgroundOverlay.Position = UDim2.new(0, 0, 0, 0)
        BackgroundOverlay.ZIndex = 19
        BackgroundOverlay.Active = true
        BackgroundOverlay.Draggable = false

        local popup = Instance.new("Frame")
        local popupCorner = Instance.new("UICorner")
        local hueGradient = Instance.new("Frame")
        local hueCorner = Instance.new("UICorner")
        local hueSlider = Instance.new("TextButton")
        local hueSliderCorner = Instance.new("UICorner")
        local colorDisplay = Instance.new("Frame")
        local colorDisplayCorner = Instance.new("UICorner")
        local confirmButton = Instance.new("TextButton")
        local confirmCorner = Instance.new("UICorner")
        local cancelButton = Instance.new("TextButton")
        local cancelCorner = Instance.new("UICorner")

        popup.Parent = BackgroundOverlay
        popup.BackgroundColor3 = currentTheme.Main
        popup.BorderSizePixel = 0
        popup.Position = UDim2.new(0.5, -150, 0.5, -100)
        popup.Size = UDim2.new(0, 300, 0, 200)
        popup.ZIndex = 20
        popup.Active = true
        popup.Draggable = false
        popup.BackgroundTransparency = 1  -- Comienza invisible
        popup.Scale = 0.8  -- Comienza más pequeño

        popupCorner.CornerRadius = UDim.new(0, 8)
        popupCorner.Parent = popup

        hueGradient.Parent = popup
        hueGradient.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        hueGradient.BorderSizePixel = 0
        hueGradient.Position = UDim2.new(0, 10, 0, 10)
        hueGradient.Size = UDim2.new(0, 200, 0, 20)
        hueGradient.ZIndex = 21
        hueGradient.BackgroundTransparency = 1

        hueCorner.CornerRadius = UDim.new(0, 10)
        hueCorner.Parent = hueGradient

        local hueGradientObject = Instance.new("UIGradient")
        hueGradientObject.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
            ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
            ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
        })
        hueGradientObject.Parent = hueGradient

        hueSlider.Parent = hueGradient
        hueSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        hueSlider.BorderSizePixel = 0
        hueSlider.Position = UDim2.new(0, -5, 0, -2)
        hueSlider.Size = UDim2.new(0, 10, 0, 24)
        hueSlider.Text = ""
        hueSlider.ZIndex = 22
        hueSlider.BackgroundTransparency = 1

        hueSliderCorner.CornerRadius = UDim.new(0, 5)
        hueSliderCorner.Parent = hueSlider

        colorDisplay.Parent = popup
        colorDisplay.BackgroundColor3 = selectedColor
        colorDisplay.BorderSizePixel = 0
        colorDisplay.Position = UDim2.new(0, 220, 0, 10)
        colorDisplay.Size = UDim2.new(0, 70, 0, 70)
        colorDisplay.ZIndex = 21
        colorDisplay.BackgroundTransparency = 1

        colorDisplayCorner.CornerRadius = UDim.new(0, 6)
        colorDisplayCorner.Parent = colorDisplay

        confirmButton.Parent = popup
        confirmButton.BackgroundColor3 = currentTheme.Accent
        confirmButton.BorderSizePixel = 0
        confirmButton.Position = UDim2.new(0, 10, 0, 160)
        confirmButton.Size = UDim2.new(0, 135, 0, 30)
        confirmButton.Text = "Confirm"
        confirmButton.Font = Enum.Font.Gotham
        confirmButton.TextColor3 = currentTheme.Text
        confirmButton.TextSize = 14
        confirmButton.ZIndex = 21
        confirmButton.AutoButtonColor = false
        confirmButton.BackgroundTransparency = 1
        confirmButton.TextTransparency = 1

        confirmCorner.CornerRadius = UDim.new(0, 6)
        confirmCorner.Parent = confirmButton

        cancelButton.Parent = popup
        cancelButton.BackgroundColor3 = currentTheme.Tertiary
        cancelButton.BorderSizePixel = 0
        cancelButton.Position = UDim2.new(0, 155, 0, 160)
        cancelButton.Size = UDim2.new(0, 135, 0, 30)
        cancelButton.Text = "Cancel"
        cancelButton.Font = Enum.Font.Gotham
        cancelButton.TextColor3 = currentTheme.Text
        cancelButton.TextSize = 14
        cancelButton.ZIndex = 21
        cancelButton.AutoButtonColor = false
        cancelButton.BackgroundTransparency = 1
        cancelButton.TextTransparency = 1

        cancelCorner.CornerRadius = UDim.new(0, 6)
        cancelCorner.Parent = cancelButton

        -- FADE IN - Animación de entrada
        TweenService:Create(BackgroundOverlay, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {BackgroundTransparency = 0.5}):Play()
        TweenService:Create(popup, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0,
            Scale = 1
        }):Play()
        
        -- Animar todos los elementos internos
        TweenService:Create(hueGradient, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
        TweenService:Create(hueSlider, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
        TweenService:Create(colorDisplay, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
        TweenService:Create(confirmButton, TweenInfo.new(0.3), {BackgroundTransparency = 0, TextTransparency = 0}):Play()
        TweenService:Create(cancelButton, TweenInfo.new(0.3), {BackgroundTransparency = 0, TextTransparency = 0}):Play()

        local hueDragging = false

        local function updateHue(input)
            local pos = input.Position.X - hueGradient.AbsolutePosition.X
            local size = hueGradient.AbsoluteSize.X
            local percent = math.clamp(pos / size, 0, 1)
            hueSlider.Position = UDim2.new(percent, -5, 0, -2)
            colorDisplay.BackgroundColor3 = Color3.fromHSV(percent, 1, 1)
        end

        hueSlider.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                hueDragging = true
                updateHue(input)
            end
        end)

        hueSlider.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                if hueDragging then
                    updateHue(input)
                end
            end
        end)

        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                hueDragging = false
            end
        end)

        hueGradient.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                updateHue(input)
            end
        end)

        -- Función para cerrar con fade out
        local function closeWithFade()
            -- FADE OUT
            TweenService:Create(BackgroundOverlay, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundTransparency = 1}):Play()
            TweenService:Create(popup, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
                BackgroundTransparency = 1,
                Scale = 0.8
            }):Play()
            
            TweenService:Create(hueGradient, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
            TweenService:Create(hueSlider, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
            TweenService:Create(colorDisplay, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
            TweenService:Create(confirmButton, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(cancelButton, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            
            wait(0.2)
            BackgroundOverlay:Destroy()
            picking = false
        end

        confirmButton.MouseButton1Click:Connect(function()
            selectedColor = colorDisplay.BackgroundColor3
            ColorDisplay.BackgroundColor3 = selectedColor
            if callback then
                callback(selectedColor)
            end
            closeWithFade()
        end)

        cancelButton.MouseButton1Click:Connect(function()
            closeWithFade()
        end)
        
        BackgroundOverlay.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                -- Capturar clics sin hacer nada
            end
        end)
    end

    ColorButton.MouseButton1Click:Connect(createColorPickerPopup)

    SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
    return ColorPickerFrame
end

        function Section:Dropdown(text, options, callback)
            local DropdownFrame = Instance.new("Frame")
            local DropdownLabel = Instance.new("TextLabel")
            local DropdownButton = Instance.new("TextButton")
            local DropdownArrow = Instance.new("TextLabel")
            local DropdownList = Instance.new("ScrollingFrame")
            local DropdownListLayout = Instance.new("UIListLayout")
            local DropdownCorner = Instance.new("UICorner")
            local DropdownButtonCorner = Instance.new("UICorner")
            local DropdownListCorner = Instance.new("UICorner")

            local expanded = false
            local selected = text
            local items = {}

            DropdownFrame.Parent = SectionFrame
            DropdownFrame.BackgroundColor3 = currentTheme.Tertiary
            DropdownFrame.BorderSizePixel = 0
            DropdownFrame.Size = UDim2.new(0, 370, 0, 28)  -- REDUCIDO de 460x32 a 370x28
            DropdownFrame.ClipsDescendants = true
            DropdownFrame.ZIndex = 6

            DropdownCorner.CornerRadius = UDim.new(0, 4)
            DropdownCorner.Parent = DropdownFrame

            DropdownLabel.Parent = DropdownFrame
            DropdownLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            DropdownLabel.BackgroundTransparency = 1.000
            DropdownLabel.Position = UDim2.new(0, 8, 0, 0)  -- Ajustado
            DropdownLabel.Size = UDim2.new(0, 300, 0, 28)
            DropdownLabel.Font = Enum.Font.Gotham
            DropdownLabel.Text = text .. ": " .. selected
            DropdownLabel.TextColor3 = currentTheme.Text
            DropdownLabel.TextSize = 13.000
            DropdownLabel.TextXAlignment = Enum.TextXAlignment.Left
            DropdownLabel.ZIndex = 7

            DropdownArrow.Parent = DropdownFrame
            DropdownArrow.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            DropdownArrow.BackgroundTransparency = 1.000
            DropdownArrow.Position = UDim2.new(0, 340, 0, 6)  -- Ajustado
            DropdownArrow.Size = UDim2.new(0, 20, 0, 16)
            DropdownArrow.Font = Enum.Font.Gotham
            DropdownArrow.Text = "▼"
            DropdownArrow.TextColor3 = currentTheme.TextMuted
            DropdownArrow.TextSize = 13.000
            DropdownArrow.ZIndex = 7

            DropdownList.Parent = DropdownFrame
            DropdownList.BackgroundColor3 = currentTheme.Secondary
            DropdownList.BorderSizePixel = 1
            DropdownList.Position = UDim2.new(0, 0, 0, 28)
            DropdownList.Size = UDim2.new(0, 370, 0, 0)
            DropdownList.CanvasSize = UDim2.new(0, 0, 0, 0)
            DropdownList.Visible = false
            DropdownList.ScrollBarThickness = 4
            DropdownList.ZIndex = 8
            DropdownList.BorderColor3 = currentTheme.TextMuted

            DropdownListCorner.CornerRadius = UDim.new(0, 4)
            DropdownListCorner.Parent = DropdownList

            DropdownListLayout.Parent = DropdownList
            DropdownListLayout.Padding = UDim.new(0, 2)

            local function updateListHeight()
                DropdownList.CanvasSize = UDim2.new(0, 0, 0, DropdownListLayout.AbsoluteContentSize.Y)
                if expanded then
                    DropdownFrame.Size = UDim2.new(0, 370, 0, 28 + DropdownListLayout.AbsoluteContentSize.Y + 4)
                    DropdownArrow.Text = "▲"
                else
                    DropdownArrow.Text = "▼"
                end
            end

            local dropdownObject = {}
            
            function dropdownObject:Add(option)
                table.insert(items, option)
                local OptionButton = Instance.new("TextButton")
                OptionButton.Parent = DropdownList
                OptionButton.BackgroundColor3 = currentTheme.Tertiary
                OptionButton.BackgroundTransparency = 0.3
                OptionButton.BorderSizePixel = 0
                OptionButton.Size = UDim2.new(0, 360, 0, 22)  -- REDUCIDO de 450x24 a 360x22
                OptionButton.Text = option
                OptionButton.Font = Enum.Font.Gotham
                OptionButton.TextColor3 = currentTheme.Text
                OptionButton.TextSize = 12.000
                OptionButton.AutoButtonColor = false
                OptionButton.ZIndex = 9

                local OptionCorner = Instance.new("UICorner")
                OptionCorner.CornerRadius = UDim.new(0, 3)
                OptionCorner.Parent = OptionButton

                OptionButton.MouseButton1Click:Connect(function()
                    selected = option
                    DropdownLabel.Text = text .. ": " .. selected
                    if callback then
                        callback(option)
                    end
                    expanded = false
                    DropdownList.Visible = false
                    DropdownFrame.Size = UDim2.new(0, 370, 0, 28)
                    DropdownArrow.Text = "▼"
                end)

                OptionButton.MouseEnter:Connect(function()
                    TweenService:Create(OptionButton, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
                end)

                OptionButton.MouseLeave:Connect(function()
                    TweenService:Create(OptionButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.3}):Play()
                end)

                updateListHeight()
            end

            function dropdownObject:Clear()
                for _, child in ipairs(DropdownList:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                items = {}
                selected = text
                DropdownLabel.Text = text .. ": " .. selected
                updateListHeight()
            end

            DropdownFrame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    expanded = not expanded
                    DropdownList.Visible = expanded
                    if expanded then
                        DropdownFrame.Size = UDim2.new(0, 370, 0, 28 + DropdownListLayout.AbsoluteContentSize.Y + 4)
                        DropdownArrow.Text = "▲"
                    else
                        DropdownFrame.Size = UDim2.new(0, 370, 0, 28)
                        DropdownArrow.Text = "▼"
                    end
                end
            end)

            for _, option in ipairs(options) do
                dropdownObject:Add(option)
            end

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return dropdownObject
        end

        function Section:Textbox(text, placeholder, numbersOnly, callback)
            local TextboxFrame = Instance.new("Frame")
            local TextboxLabel = Instance.new("TextLabel")
            local Textbox = Instance.new("TextBox")
            local TextboxCorner = Instance.new("UICorner")
            local TextboxFrameCorner = Instance.new("UICorner")

            TextboxFrame.Parent = SectionFrame
            TextboxFrame.BackgroundColor3 = currentTheme.Tertiary
            TextboxFrame.BorderSizePixel = 0
            TextboxFrame.Size = UDim2.new(0, 370, 0, 45)  -- REDUCIDO
            TextboxFrame.ZIndex = 6

            TextboxFrameCorner.CornerRadius = UDim.new(0, 4)
            TextboxFrameCorner.Parent = TextboxFrame

            TextboxLabel.Parent = TextboxFrame
            TextboxLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            TextboxLabel.BackgroundTransparency = 1.000
            TextboxLabel.Position = UDim2.new(0, 5, 0, 5)
            TextboxLabel.Size = UDim2.new(0, 300, 0, 18)  -- REDUCIDO
            TextboxLabel.Font = Enum.Font.Gotham
            TextboxLabel.Text = text
            TextboxLabel.TextColor3 = currentTheme.Text
            TextboxLabel.TextSize = 13.000
            TextboxLabel.TextXAlignment = Enum.TextXAlignment.Left
            TextboxLabel.ZIndex = 7

            Textbox.Parent = TextboxFrame
            Textbox.BackgroundColor3 = currentTheme.Secondary
            Textbox.BorderSizePixel = 0
            Textbox.Position = UDim2.new(0, 5, 0, 24)  -- Ajustado
            Textbox.Size = UDim2.new(0, 360, 0, 18)  -- REDUCIDO
            Textbox.Font = Enum.Font.Gotham
            Textbox.PlaceholderText = placeholder
            Textbox.Text = ""
            Textbox.TextColor3 = currentTheme.Text
            Textbox.TextSize = 12.000
            Textbox.ClearTextOnFocus = false
            Textbox.ZIndex = 7

            if numbersOnly then
                Textbox.Text = "0"
            end

            TextboxCorner.CornerRadius = UDim.new(0, 3)  -- REDUCIDO
            TextboxCorner.Parent = Textbox

            Textbox.FocusLost:Connect(function(enterPressed)
                if enterPressed then
                    if numbersOnly then
                        local num = tonumber(Textbox.Text) or 0
                        Textbox.Text = tostring(num)
                        if callback then
                            callback(num)
                        end
                    else
                        if callback then
                            callback(Textbox.Text)
                        end
                    end
                end
            end)

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return Textbox
        end

        function Section:Bind(text, defaultKey, callback)
            local BindFrame = Instance.new("Frame")
            local BindLabel = Instance.new("TextLabel")
            local BindButton = Instance.new("TextButton")
            local BindCorner = Instance.new("UICorner")
            local BindFrameCorner = Instance.new("UICorner")

            local binding = false
            local currentKey = defaultKey or Enum.KeyCode.RightShift
            local keyName = currentKey.Name or "RightShift"

            BindFrame.Parent = SectionFrame
            BindFrame.BackgroundColor3 = currentTheme.Tertiary
            BindFrame.BorderSizePixel = 0
            BindFrame.Size = UDim2.new(0, 370, 0, 28)  -- REDUCIDO
            BindFrame.ZIndex = 6

            BindFrameCorner.CornerRadius = UDim.new(0, 4)
            BindFrameCorner.Parent = BindFrame

            BindLabel.Parent = BindFrame
            BindLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            BindLabel.BackgroundTransparency = 1.000
            BindLabel.Position = UDim2.new(0, 5, 0, 0)
            BindLabel.Size = UDim2.new(0, 260, 0, 28)  -- REDUCIDO
            BindLabel.Font = Enum.Font.Gotham
            BindLabel.Text = text
            BindLabel.TextColor3 = currentTheme.Text
            BindLabel.TextSize = 13.000
            BindLabel.TextXAlignment = Enum.TextXAlignment.Left
            BindLabel.ZIndex = 7

            BindButton.Parent = BindFrame
            BindButton.BackgroundColor3 = currentTheme.Secondary
            BindButton.BorderSizePixel = 0
            BindButton.Position = UDim2.new(0, 280, 0, 3)  -- Ajustado
            BindButton.Size = UDim2.new(0, 80, 0, 22)  -- REDUCIDO
            BindButton.Text = keyName
            BindButton.Font = Enum.Font.Gotham
            BindButton.TextColor3 = currentTheme.Text
            BindButton.TextSize = 12.000
            BindButton.AutoButtonColor = false
            BindButton.ZIndex = 7

            BindCorner.CornerRadius = UDim.new(0, 3)  -- REDUCIDO
            BindCorner.Parent = BindButton

            BindButton.MouseButton1Click:Connect(function()
                binding = true
                BindButton.Text = "..."
            end)

            UserInputService.InputBegan:Connect(function(input, gameProcessed)
                if gameProcessed then return end
                
                if binding then
                    if input.UserInputType == Enum.UserInputType.Keyboard then
                        currentKey = input.KeyCode
                        keyName = currentKey.Name
                        BindButton.Text = keyName
                        binding = false
                        if callback then
                            callback(currentKey)
                        end
                    end
                else
                    if input.KeyCode == currentKey then
                        if callback then
                            callback(currentKey)
                        end
                    end
                end
            end)

            SectionFrame.CanvasSize = UDim2.new(0, 0, 0, SectionLayout.AbsoluteContentSize.Y + 30)
            return BindFrame
        end

        return Section
    end

    function Servers:Select(Name)
        for i, v in pairs(ServersHold:GetChildren()) do
            if v:IsA("TextButton") then
                if v.Name == Name then
                    TweenService:Create(v, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
                else
                    TweenService:Create(v, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
                end
            end
        end
        currentservertoggled = Name
        
        for channelName, channelData in pairs(ServerChannels[Name]) do
            if channelData.Button then
                channelData.Button.Visible = true
            end
        end
        
        for otherServer, channels in pairs(ServerChannels) do
            if otherServer ~= Name then
                for _, channelData in pairs(channels) do
                    if channelData.Button then
                        channelData.Button.Visible = false
                    end
                end
            end
        end
    end

    function Servers:SelectChannel(serverName, channelName)
        if serverName and channelName and ServerChannels[serverName] and ServerChannels[serverName][channelName] then
            ServerChannels[serverName][channelName].Button.BackgroundColor3 = currentTheme.Accent
            ServerChannels[serverName][channelName].Button.BackgroundTransparency = 0
            currentchanneltoggled = channelName
            
            local fullName = serverName .. ":" .. channelName
            for sectionName, section in pairs(Sections) do
                if sectionName == fullName then
                    section.Visible = true
                else
                    section.Visible = false
                end
            end
        end
    end

    return {
        Server = Servers,
        Channel = Servers.Channel,
        CreateSection = Servers.Channel,  -- CreateSection es lo mismo que Channel
        SelectChannel = Servers.SelectChannel,
        SetTheme = DiscordLib.SetTheme
    }
end

function DiscordLib:Notification(data)
    local title = data.title or "Notification"
    local desc = data.desc or ""
    local time = data.time or 5

    local NotifHolder = Instance.new("Frame")
    local NotifTitle = Instance.new("TextLabel")
    local NotifDesc = Instance.new("TextLabel")
    local NotifCorner = Instance.new("UICorner")

    NotifHolder.Name = "Notification"
    NotifHolder.Parent = Discord
    NotifHolder.BackgroundColor3 = currentTheme.Main
    NotifHolder.BorderSizePixel = 0
    NotifHolder.Position = UDim2.new(1, -310, 0, 10)
    NotifHolder.Size = UDim2.new(0, 280, 0, 65)  -- REDUCIDO un poco
    NotifHolder.ClipsDescendants = true
    NotifHolder.BackgroundTransparency = 1
    NotifHolder.ZIndex = 100

    NotifCorner.CornerRadius = UDim.new(0, 6)
    NotifCorner.Parent = NotifHolder

    NotifTitle.Parent = NotifHolder
    NotifTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    NotifTitle.BackgroundTransparency = 1.000
    NotifTitle.Position = UDim2.new(0, 10, 0, 8)
    NotifTitle.Size = UDim2.new(0, 260, 0, 18)
    NotifTitle.Font = Enum.Font.GothamBold
    NotifTitle.Text = title
    NotifTitle.TextColor3 = currentTheme.Text
    NotifTitle.TextSize = 15.000
    NotifTitle.TextXAlignment = Enum.TextXAlignment.Left
    NotifTitle.TextTransparency = 1
    NotifTitle.ZIndex = 101

    NotifDesc.Parent = NotifHolder
    NotifDesc.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    NotifDesc.BackgroundTransparency = 1.000
    NotifDesc.Position = UDim2.new(0, 10, 0, 30)
    NotifDesc.Size = UDim2.new(0, 260, 0, 25)
    NotifDesc.Font = Enum.Font.Gotham
    NotifDesc.Text = desc
    NotifDesc.TextColor3 = currentTheme.TextMuted
    NotifDesc.TextSize = 13.000
    NotifDesc.TextWrapped = true
    NotifDesc.TextXAlignment = Enum.TextXAlignment.Left
    NotifDesc.TextYAlignment = Enum.TextYAlignment.Top
    NotifDesc.TextTransparency = 1
    NotifDesc.ZIndex = 101

    NotifHolder.Position = UDim2.new(1, -310, 0, -80)
    TweenService:Create(NotifHolder, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Position = UDim2.new(1, -310, 0, 10), BackgroundTransparency = 0}):Play()
    TweenService:Create(NotifTitle, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 0}):Play()
    TweenService:Create(NotifDesc, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 0}):Play()

    spawn(function()
        wait(time)
        TweenService:Create(NotifHolder, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Position = UDim2.new(1, -310, 0, -80), BackgroundTransparency = 1}):Play()
        TweenService:Create(NotifTitle, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 1}):Play()
        TweenService:Create(NotifDesc, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 1}):Play()
        wait(0.3)
        NotifHolder:Destroy()
    end)
end

return DiscordLib
